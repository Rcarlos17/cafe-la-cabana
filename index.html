<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CafÃ© La CabaÃ±a</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

  <!-- NAVBAR -->
  <div class="flex justify-between items-center p-4 bg-amber-800 text-white shadow">
    <h1 class="text-2xl font-bold">â˜• CafÃ© La CabaÃ±a</h1>

    <div class="flex gap-4">
      <button id="loginBtn" class="bg-white text-amber-800 px-4 py-2 rounded">Iniciar sesiÃ³n</button>
      <button id="cartBtn" class="bg-white text-amber-800 px-4 py-2 rounded">ðŸ›’ Carrito</button>
    </div>
  </div>

  <!-- CONTENEDOR PRINCIPAL -->
  <div id="root" class="p-4"></div>

  <!-- MODAL LOGIN -->
  <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded shadow w-80">
      <h2 class="text-xl font-bold mb-4">Iniciar sesiÃ³n</h2>

      <input id="emailInput" type="email" class="border p-2 w-full mb-2" placeholder="Correo">
      <input id="passwordInput" type="password" class="border p-2 w-full mb-4" placeholder="ContraseÃ±a">

      <button id="loginEmailBtn" class="bg-amber-700 text-white w-full p-2 rounded mb-2">Entrar</button>
      <button id="loginGoogleBtn" class="bg-red-600 text-white w-full p-2 rounded">Entrar con Google</button>

      <button id="closeLoginModal" class="mt-4 text-gray-500 underline w-full">Cerrar</button>
    </div>
  </div>

  <!-- MODAL CARRITO -->
  <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded shadow w-96">
      <h2 class="text-xl font-bold mb-4">ðŸ›’ Carrito</h2>
      <div id="cartItems"></div>
      <button id="checkoutBtn" class="bg-green-600 text-white w-full p-2 rounded mt-4">Realizar pedido</button>
      <button id="closeCartModal" class="mt-4 text-gray-500 underline w-full">Cerrar</button>
    </div>
  </div>

  <!-- MODAL DE PEDIDO -->
  <div id="pedidoModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded shadow w-96">
      <h2 class="text-xl font-bold mb-4">Realizar Pedido</h2>

      <input id="clienteNombre" class="border p-2 w-full mb-2" placeholder="Tu nombre">
      <input id="clienteTelefono" class="border p-2 w-full mb-2" placeholder="Tu nÃºmero">
      <textarea id="clienteNotas" class="border p-2 w-full mb-4" placeholder="Notas adicionales"></textarea>

      <button id="enviarPedidoBtn" class="bg-green-600 text-white w-full p-2 rounded">Enviar pedido</button>
      <button id="cerrarPedidoModal" class="mt-4 text-gray-500 underline w-full">Cancelar</button>
    </div>
  </div>

  <!-- FIREBASE CONFIG -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAcnpjZmvIX1qdHkj4j0TTg13tOVYbZpn0",
      authDomain: "cafe-la-cabana-30fa5.firebaseapp.com",
      projectId: "cafe-la-cabana-30fa5",
      storageBucket: "cafe-la-cabana-30fa5.firebasestorage.app",
      messagingSenderId: "1013891358492",
      appId: "1:1013891358492:web:a80b4dff4aafe1375ea4d9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const googleProvider = new GoogleAuthProvider();

    window.db = db;
    window.auth = auth;
    window.googleProvider = googleProvider;
    window.collection = collection;
    window.addDoc = addDoc;
    window.serverTimestamp = serverTimestamp;

    console.log("ðŸ”¥ Firebase cargado correctamente");
  </script>
  <!-- SCRIPT PARA ENVIAR PEDIDOS A FIRESTORE -->
  <script>
    async function enviarPedidoAFirebase(pedido) {
      try {
        await window.addDoc(window.collection(window.db, "orders"), {
          ...pedido,
          fecha: window.serverTimestamp()
        });

        console.log("âœ… Pedido enviado correctamente");
        return true;

      } catch (error) {
        console.error("âŒ Error al guardar pedido:", error);
        return false;
      }
    }

    // EVENTO DEL BOTÃ“N "ENVIAR PEDIDO"
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("enviarPedidoBtn");

      if (btn) {
        btn.addEventListener("click", async () => {
          const nombre = document.getElementById("clienteNombre").value;
          const telefono = document.getElementById("clienteTelefono").value;
          const notas = document.getElementById("clienteNotas").value;

          const carrito = JSON.parse(localStorage.getItem("carrito")) || [];

          if (!nombre || carrito.length === 0) {
            alert("Debes escribir tu nombre y tener productos en el carrito.");
            return;
          }

          const pedido = {
            nombre,
            telefono,
            notas,
            productos: carrito,
            estado: "pendiente"
          };

          const ok = await enviarPedidoAFirebase(pedido);

          if (ok) {
            alert("ðŸŽ‰ Pedido realizado con Ã©xito");
            localStorage.removeItem("carrito");
            document.getElementById("pedidoModal").classList.add("hidden");
          }
        });
      }
    });
  </script>

  <!-- LIBRERÃAS DE REACT -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- INICIA REACT -->
  <script type="text/babel">

    const CafeLaCabana = () => {
      const [productos, setProductos] = React.useState([]);
      const [carrito, setCarrito] = React.useState(
        JSON.parse(localStorage.getItem("carrito") || "[]")
      );

      React.useEffect(() => {
        async function cargarProductos() {
          const res = await fetch("productos.json");
          const data = await res.json();
          setProductos(data);
        }
        cargarProductos();
      }, []);

      const agregarAlCarrito = (producto) => {
        const nuevo = [...carrito, producto];
        setCarrito(nuevo);
        localStorage.setItem("carrito", JSON.stringify(nuevo));
      };

      return (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {productos.map((p, index) => (
            <div key={index} className="bg-white p-4 shadow rounded">
              <img src={p.imagen} className="w-full h-32 object-cover rounded"/>
              <h3 className="font-bold mt-2">{p.nombre}</h3>
              <p className="text-gray-600">${p.precio}</p>
              <button
                onClick={() => agregarAlCarrito(p)}
                className="bg-amber-700 text-white px-3 py-1 rounded mt-2">
                Agregar
              </button>
            </div>
          ))}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root"))
      .render(<CafeLaCabana />);
  </script>
   </body>
   </html>

