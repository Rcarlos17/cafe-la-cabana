<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caf√© La Caba√±a - Men√∫</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#92400e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
      import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

      const firebaseConfig = {
        apiKey: "AIzaSyAcnpjZmvIX1qdHkj4j0TTg13tOVYbZpn0",
        authDomain: "cafe-la-cabana-30fa5.firebaseapp.com",
        projectId: "cafe-la-cabana-30fa5",
        storageBucket: "cafe-la-cabana-30fa5.firebasestorage.app",
        messagingSenderId: "1013891358492",
        appId: "1:1013891358492:web:a80b4dff4aafe1375ea4d9"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      window.firebaseDB = db;
      window.firestoreCollection = collection;
      window.firestoreAddDoc = addDoc;
      window.firestoreServerTimestamp = serverTimestamp;
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const CafeLaCabana = () => {
          const [cart, setCart] = React.useState([]);
          const [showCart, setShowCart] = React.useState(false);
          const [selectedCategory, setSelectedCategory] = React.useState('all');
          const [showOrderModal, setShowOrderModal] = React.useState(false);
          const [customerName, setCustomerName] = React.useState('');
          const [orderNotes, setOrderNotes] = React.useState('');
          const [isSubmitting, setIsSubmitting] = React.useState(false);

          const menuItems = [
            {
              id: 1,
              name: 'Caf√© Americano',
              category: 'hot',
              price: 35,
              description: 'Espresso suave con agua caliente',
              image: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400&h=300&fit=crop'
            },
            {
              id: 2,
              name: 'Cappuccino',
              category: 'hot',
              price: 45,
              description: 'Espresso con leche vaporizada y espuma cremosa',
              image: 'https://images.unsplash.com/photo-1572442388796-11668a67e53d?w=400&h=300&fit=crop'
            },
            {
              id: 3,
              name: 'Latte',
              category: 'hot',
              price: 48,
              description: 'Espresso con abundante leche vaporizada',
              image: 'https://images.unsplash.com/photo-1561882468-9110e03e0f78?w=400&h=300&fit=crop'
            },
            {
              id: 4,
              name: 'Chocolate Caliente',
              category: 'hot',
              price: 42,
              description: 'Chocolate premium con crema batida',
              image: 'https://images.unsplash.com/photo-1517578239113-b03992dcdd25?w=400&h=300&fit=crop'
            },
            {
              id: 5,
              name: 'Frapp√© de Caramelo',
              category: 'cold',
              price: 55,
              description: 'Caf√© helado con caramelo y crema batida',
              image: 'https://images.unsplash.com/photo-1551024601-bec78aea704b?w=400&h=300&fit=crop'
            },
            {
              id: 6,
              name: 'Smoothie de Fresa',
              category: 'cold',
              price: 50,
              description: 'Fresas frescas con yogurt y miel',
              image: 'https://images.unsplash.com/photo-1505252585461-04db1eb84625?w=400&h=300&fit=crop'
            },
            {
              id: 7,
              name: 'Limonada Mineral',
              category: 'cold',
              price: 38,
              description: 'Limones frescos con agua mineral y hierbabuena',
              image: 'https://images.unsplash.com/photo-1523677011781-c91d1bbe2f9d?w=400&h=300&fit=crop'
            },
            {
              id: 8,
              name: 'Caf√© Fr√≠o',
              category: 'cold',
              price: 45,
              description: 'Cold brew con hielo y un toque de vainilla',
              image: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400&h=300&fit=crop'
            },
            {
              id: 9,
              name: 'Cheesecake',
              category: 'dessert',
              price: 55,
              description: 'Pay de queso cremoso con frutos rojos',
              image: 'https://images.unsplash.com/photo-1533134486753-c833f0ed4866?w=400&h=300&fit=crop'
            },
            {
              id: 10,
              name: 'Brownie con Helado',
              category: 'dessert',
              price: 60,
              description: 'Brownie de chocolate caliente con helado de vainilla',
              image: 'https://images.unsplash.com/photo-1606313564559-2e0c5c2d5c6f?w=400&h=300&fit=crop'
            },
            {
              id: 11,
              name: 'Tarta de Manzana',
              category: 'dessert',
              price: 48,
              description: 'Cl√°sica tarta de manzana con canela',
              image: 'https://images.unsplash.com/photo-1535920527002-b35e96722eb9?w=400&h=300&fit=crop'
            },
            {
              id: 12,
              name: 'Croissant',
              category: 'snack',
              price: 35,
              description: 'Croissant de mantequilla reci√©n horneado',
              image: 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=400&h=300&fit=crop'
            },
            {
              id: 13,
              name: 'Panini de Jam√≥n',
              category: 'snack',
              price: 65,
              description: 'Panini con jam√≥n, queso y vegetales',
              image: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?w=400&h=300&fit=crop'
            },
            {
              id: 14,
              name: 'Galletas Caseras',
              category: 'snack',
              price: 25,
              description: 'Pack de 3 galletas con chispas de chocolate',
              image: 'https://images.unsplash.com/photo-1499636136210-6f4ee915583e?w=400&h=300&fit=crop'
            }
          ];

          const categories = [
            { id: 'all', name: 'Todo' },
            { id: 'hot', name: 'Calientes' },
            { id: 'cold', name: 'Fr√≠as' },
            { id: 'dessert', name: 'Postres' },
            { id: 'snack', name: 'Snacks' }
          ];

          const addToCart = (item) => {
            const existingItem = cart.find(i => i.id === item.id);
            if (existingItem) {
              setCart(cart.map(i => 
                i.id === item.id ? { ...i, quantity: i.quantity + 1 } : i
              ));
            } else {
              setCart([...cart, { ...item, quantity: 1 }]);
            }
          };

          const removeFromCart = (itemId) => {
            const existingItem = cart.find(i => i.id === itemId);
            if (existingItem.quantity === 1) {
              setCart(cart.filter(i => i.id !== itemId));
            } else {
              setCart(cart.map(i => 
                i.id === itemId ? { ...i, quantity: i.quantity - 1 } : i
              ));
            }
          };

          const deleteFromCart = (itemId) => {
            setCart(cart.filter(i => i.id !== itemId));
          };

          const getTotal = () => {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
          };

          const openOrderModal = () => {
            if (cart.length === 0) {
              alert('Tu carrito est√° vac√≠o');
              return;
            }
            setShowOrderModal(true);
          };

          const submitOrder = async (e) => {
            e.preventDefault();
            setIsSubmitting(true);
            
            try {
              const order = {
                customerName: customerName || 'Cliente',
                items: cart,
                total: getTotal(),
                notes: orderNotes,
                status: 'pending',
                createdAt: window.firestoreServerTimestamp()
              };

              // Guardar en Firebase
              await window.firestoreAddDoc(
                window.firestoreCollection(window.firebaseDB, 'orders'),
                order
              );

              // Limpiar
              setCart([]);
              setCustomerName('');
              setOrderNotes('');
              setShowOrderModal(false);
              setShowCart(false);
              setIsSubmitting(false);

              alert('‚úÖ ¬°Pedido realizado con √©xito!\n\nTu pedido est√° siendo preparado.');
            } catch (error) {
              console.error('Error al guardar pedido:', error);
              alert('‚ùå Error al enviar el pedido. Intenta de nuevo.');
              setIsSubmitting(false);
            }
          };

          const filteredItems = selectedCategory === 'all' 
            ? menuItems 
            : menuItems.filter(item => item.category === selectedCategory);

          return (
            <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50">
              <header className="bg-gradient-to-r from-amber-800 to-orange-700 text-white shadow-lg sticky top-0 z-40">
                <div className="container mx-auto px-4 py-4">
                  <div className="flex justify-between items-center">
                    <div>
                      <h1 className="text-3xl font-bold flex items-center gap-2">
                        ‚òï Caf√© La Caba√±a
                      </h1>
                      <p className="text-amber-100 text-sm mt-1">Sabor que inspira tu d√≠a</p>
                    </div>
                    <button 
                      onClick={() => setShowCart(!showCart)}
                      className="relative bg-white text-amber-800 px-4 py-2 rounded-full font-semibold hover:bg-amber-100 transition flex items-center gap-2"
                    >
                      üõí {cart.length}
                      {cart.length > 0 && (
                        <span className="absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">
                          {cart.reduce((sum, item) => sum + item.quantity, 0)}
                        </span>
                      )}
                    </button>
                  </div>
                </div>
              </header>

              <div className="bg-white shadow-md sticky top-20 z-30">
                <div className="container mx-auto px-4 py-4">
                  <div className="flex gap-2 overflow-x-auto">
                    {categories.map(cat => (
                      <button
                        key={cat.id}
                        onClick={() => setSelectedCategory(cat.id)}
                        className={`px-4 py-2 rounded-full font-medium whitespace-nowrap transition ${
                          selectedCategory === cat.id
                            ? 'bg-amber-600 text-white'
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        {cat.name}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              <div className="container mx-auto px-4 py-8">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {filteredItems.map(item => (
                    <div key={item.id} className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition transform hover:-translate-y-1">
                      <div className="h-48 overflow-hidden">
                        <img 
                          src={item.image} 
                          alt={item.name}
                          className="w-full h-full object-cover"
                        />
                      </div>
                      <div className="p-5">
                        <h3 className="text-xl font-bold text-gray-800 mb-2">{item.name}</h3>
                        <p className="text-gray-600 text-sm mb-4">{item.description}</p>
                        <div className="flex justify-between items-center">
                          <span className="text-2xl font-bold text-amber-700">${item.price}</span>
                          <button
                            onClick={() => addToCart(item)}
                            className="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition"
                          >
                            ‚ûï Agregar
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {showCart && (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50" onClick={() => setShowCart(false)}>
                  <div 
                    className="fixed right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl overflow-y-auto"
                    onClick={(e) => e.stopPropagation()}
                  >
                    <div className="p-6">
                      <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">Tu Pedido</h2>
                        <button 
                          onClick={() => setShowCart(false)}
                          className="text-gray-500 hover:text-gray-700 text-2xl"
                        >
                          ‚úï
                        </button>
                      </div>

                      {cart.length === 0 ? (
                        <div className="text-center py-12">
                          <div className="text-6xl mb-4">üõí</div>
                          <p className="text-gray-500">Tu carrito est√° vac√≠o</p>
                        </div>
                      ) : (
                        <>
                          <div className="space-y-4 mb-6">
                            {cart.map(item => (
                              <div key={item.id} className="flex gap-4 bg-gray-50 p-4 rounded-lg">
                                <img 
                                  src={item.image} 
                                  alt={item.name}
                                  className="w-20 h-20 object-cover rounded-lg"
                                />
                                <div className="flex-1">
                                  <h3 className="font-semibold text-gray-800">{item.name}</h3>
                                  <p className="text-amber-700 font-bold">${item.price}</p>
                                  <div className="flex items-center gap-3 mt-2">
                                    <button
                                      onClick={() => removeFromCart(item.id)}
                                      className="bg-gray-300 text-gray-700 w-7 h-7 rounded-full hover:bg-gray-400"
                                    >
                                      ‚ûñ
                                    </button>
                                    <span className="font-semibold">{item.quantity}</span>
                                    <button
                                      onClick={() => addToCart(item)}
                                      className="bg-amber-600 text-white w-7 h-7 rounded-full hover:bg-amber-700"
                                    >
                                      ‚ûï
                                    </button>
                                    <button
                                      onClick={() => deleteFromCart(item.id)}
                                      className="ml-auto text-red-500 hover:text-red-700"
                                    >
                                      ‚úï
                                    </button>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>

                          <div className="border-t pt-4">
                            <div className="flex justify-between items-center mb-4">
                              <span className="text-xl font-bold text-gray-800">Total:</span>
                              <span className="text-3xl font-bold text-amber-700">${getTotal()}</span>
                            </div>
                            <button 
                              onClick={openOrderModal}
                              className="w-full bg-gradient-to-r from-amber-600 to-orange-600 text-white py-4 rounded-lg font-bold text-lg hover:from-amber-700 hover:to-orange-700 transition"
                            >
                              üì± Realizar Pedido
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                </div>
              )}

              {showOrderModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                  <div className="bg-white rounded-lg max-w-md w-full">
                    <div className="p-6">
                      <h2 className="text-2xl font-bold text-gray-800 mb-4">Confirmar Pedido</h2>
                      
                      <form onSubmit={submitOrder}>
                        <div className="mb-4">
                          <label className="block text-sm font-semibold text-gray-700 mb-2">
                            Tu nombre (opcional)
                          </label>
                          <input
                            type="text"
                            value={customerName}
                            onChange={(e) => setCustomerName(e.target.value)}
                            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
                            placeholder="Ej: Juan P√©rez"
                            disabled={isSubmitting}
                          />
                        </div>

                        <div className="mb-4">
                          <label className="block text-sm font-semibold text-gray-700 mb-2">
                            Notas especiales (opcional)
                          </label>
                          <textarea
                            value={orderNotes}
                            onChange={(e) => setOrderNotes(e.target.value)}
                            className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
                            rows="3"
                            placeholder="Sin az√∫car, extra caliente, etc."
                            disabled={isSubmitting}
                          />
                        </div>

                        <div className="bg-amber-50 p-4 rounded-lg mb-4">
                          <div className="flex justify-between items-center">
                            <span className="font-semibold text-gray-700">Total a pagar:</span>
                            <span className="text-2xl font-bold text-amber-700">${getTotal()}</span>
                          </div>
                        </div>

                        <div className="flex gap-3">
                          <button
                            type="submit"
                            disabled={isSubmitting}
                            className="flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed"
                          >
                            {isSubmitting ? '‚è≥ Enviando...' : '‚úÖ Confirmar Pedido'}
                          </button>
                          <button
                            type="button"
                            onClick={() => setShowOrderModal(false)}
                            disabled={isSubmitting}
                            className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition disabled:opacity-50"
                          >
                            Cancelar
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        ReactDOM.render(<CafeLaCabana />, document.getElementById('root'));
    </script>
</body>
</html>
